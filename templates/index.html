{% extends "base.html" %}

{% block content %}
<section class="hero" id="home">
    <div class="hero-content">
        <h1>
            <span class="fade-wrap delay-100" style="display:block">Innovative</span>
            <span class="gradient-text fade-wrap delay-200">Web & AI Solutions</span>
        </h1>
        <p class="fade-wrap delay-300">
            React, Flask, 그리고 Deep Learning을 활용하여<br>
            가치 있는 서비스를 만드는 개발자입니다.
        </p>
        <div class="fade-wrap delay-300">
            <a href="#projects" class="btn btn-primary">프로젝트 보기</a>
        </div>
    </div>
</section>

<section class="section container">
    <div class="profile-section" style="margin-bottom: 6rem;">
        <h3 class="fade-wrap"
            style="border-left: 4px solid var(--accent-color); padding-left: 1rem; margin-bottom: 2rem;">Profile</h3>
        <div class="profile-grid fade-wrap delay-100">
            <div class="profile-info">
                <div class="profile-item">
                    <span class="profile-label">Name</span>
                    <a href="{{ profile.github_url }}" target="_blank" class="profile-value profile-link">{{
                        profile.name }}</a>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Email</span>
                    <a href="mailto:{{ profile.email }}" class="profile-value profile-link">{{ profile.email }}</a>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Phone</span>
                    <a href="tel:{{ profile.phone }}" class="profile-value profile-link">{{ profile.phone }}</a>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Address</span>
                    <a href="https://www.google.com/search?q={{ profile.address|urlencode }}" target="_blank"
                        class="profile-value profile-link">{{ profile.address }}</a>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Education</span>
                    <div class="education-grouped">
                        <span class="institution-name">{{ profile.education.institution }}</span>
                        <div class="education-links" style="display: inline-block; margin-left: 0.5rem;">
                            {% for edu in profile.education.majors %}
                            <a href="{{ edu.url }}" target="_blank" class="profile-value profile-link">{{ edu.label
                                }}</a>
                            {% if not loop.last %} / {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="profile-extra"
                style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--card-border);">
                <span class="profile-label" style="margin-bottom: 1.5rem; display: block;">Education & Training</span>
                <div class="training-groups">
                    {% for group in profile.training_groups %}
                    <div class="training-group" style="margin-bottom: 1.5rem;">
                        <div class="org-name"
                            style="font-weight: 600; color: var(--accent-light); margin-bottom: 0.5rem; font-size: 0.95rem;">
                            {{ group.organization }}
                        </div>
                        <ul class="training-list" style="margin-top: 0; padding-left: 1.2rem;">
                            {% for detail in group.details %}
                            <li class="profile-value"
                                style="font-size: 0.95rem; font-weight: 400; color: var(--text-secondary); margin-bottom: 0.3rem;">
                                {{ detail }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="tech-stack-summary" style="margin-bottom: 6rem;">
        <h3 class="fade-wrap"
            style="border-left: 4px solid var(--accent-color); padding-left: 1rem; margin-bottom: 2rem;">Technical Stack
        </h3>
        <div class="tech-grid fade-wrap delay-100">
            {% for category, techs in profile.tech_stack_summary.items() %}
            <div class="tech-group">
                <h4>{{ category }}</h4>
                <div class="tech-tags">
                    {% for tech in techs %}
                    <span class="tag {% if tech.highlight %}highlight{% endif %}">
                        <i class="{{ tech.icon }}"></i>
                        {{ tech.name }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="category-section" style="margin-bottom: 4rem;" id="projects">
        <div class="section-header fade-wrap">
            <h3>Team Projects</h3>
            <button class="view-toggle-btn" data-target="carousel-team">
                <i class="fa-solid fa-list"></i> Change View
            </button>
        </div>
        <div class="carousel-container fade-wrap delay-100 {{ 'view-carousel' if team_projects|length > 3 else 'view-grid' }}"
            id="carousel-team">
            <div class="scrolling-wrapper">
                {% for project in team_projects %}
                <a href="{{ url_for('project_detail', project_id=project.id) }}" class="card">
                    <div class="card-type">{{ project.type }}</div>
                    <h3>{{ project.title }}</h3>
                    <p>{{ project.summary }}</p>
                    <div class="tech-tags">
                        {% for tech in project.tech_list %}
                        <span class="tag">{{ tech }}</span>
                        {% endfor %}
                    </div>
                </a>
                {% endfor %}
            </div>
            <div class="carousel-controls">
                <button class="scroll-btn prev" aria-label="Previous"><i class="fa-solid fa-chevron-left"></i></button>
                <div class="scroll-progress-track">
                    <div class="scroll-progress-bar"></div>
                </div>
                <button class="scroll-btn next" aria-label="Next"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <div class="category-section">
        <div class="section-header fade-wrap">
            <h3>Personal Work</h3>
            <button class="view-toggle-btn" data-target="carousel-personal">
                <i class="fa-solid fa-list"></i> Change View
            </button>
        </div>
        <div class="carousel-container fade-wrap delay-100 {{ 'view-carousel' if personal_projects|length > 3 else 'view-grid' }}"
            id="carousel-personal">
            <div class="scrolling-wrapper">
                {% for project in personal_projects %}
                <a href="{{ url_for('project_detail', project_id=project.id) }}" class="card">
                    <div class="card-type">{{ project.type }}</div>
                    <h3>{{ project.title }}</h3>
                    <p>{{ project.summary }}</p>
                    <div class="tech-tags">
                        {% for tech in project.tech_list %}
                        <span class="tag">{{ tech }}</span>
                        {% endfor %}
                    </div>
                </a>
                {% endfor %}
            </div>
            <div class="carousel-controls">
                <button class="scroll-btn prev" aria-label="Previous"><i class="fa-solid fa-chevron-left"></i></button>
                <div class="scroll-progress-track">
                    <div class="scroll-progress-bar"></div>
                </div>
                <button class="scroll-btn next" aria-label="Next"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvases = document.querySelectorAll('.profile-canvas');
        const dpr = window.devicePixelRatio || 1;

        canvases.forEach(canvas => {
            const ctx = canvas.getContext('2d');
            const text = canvas.getAttribute('data-text');
            const font = canvas.getAttribute('data-font') || '500 1.1rem Inter';
            const color = canvas.getAttribute('data-color') || '#f8fafc';

            // Set temporary font to measure
            ctx.font = font;
            const metrics = ctx.measureText(text);
            const textWidth = metrics.width;
            const fontSizePart = font.split(' ').find(p => p.includes('rem') || p.includes('px')) || '1.1rem';
            const fontSize = parseFloat(fontSizePart);
            const textHeight = (fontSizePart.includes('rem') ? fontSize * 16 : fontSize) * 1.5;

            // Set canvas size with dpr scaling for sharpness
            canvas.width = textWidth * dpr;
            canvas.height = textHeight * dpr;
            canvas.style.width = `${textWidth}px`;
            canvas.style.height = `${textHeight}px`;

            ctx.scale(dpr, dpr);
            ctx.font = font;
            ctx.fillStyle = color;
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 0, textHeight / 2);
        });
    });
</script>
{% endblock %}